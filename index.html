<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>PDFMint | Free Online PDF Tools - Merge, Split, Compress & Convert</title>
    <meta name="description" content="Free online PDF tools to merge, split, compress, and convert PDFs. 100% free, secure client-side processing. No installation required.">
    <meta name="keywords" content="pdf merger, pdf splitter, compress pdf, jpg to pdf, combine pdf, extract pdf pages, free pdf tools, client side pdf">
    <meta name="author" content="PDFMint">
    <meta name="robots" content="index, follow">
    
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yourusername.github.io/pdfmint/">
    <meta property="og:title" content="PDFMint - All-in-One PDF Tools">
    <meta property="og:description" content="Merge, Split, Compress and Convert PDFs entirely in your browser. Fast, free, and secure.">
    
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="PDFMint - All-in-One PDF Tools">
    <meta property="twitter:description" content="Merge, Split, Compress and Convert PDFs entirely in your browser.">

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "PDFMint",
      "url": "https://yourusername.github.io/pdfmint/",
      "description": "A suite of free online PDF tools to manipulate documents securely in the browser.",
      "applicationCategory": "Productivity",
      "operatingSystem": "All",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Utility */
        .drag-active { border-color: #16a34a !important; background-color: #f0fdf4 !important; }
        
        /* Navigation Tabs */
        .nav-item { cursor: pointer; border-bottom: 2px solid transparent; color: #6b7280; transition: all 0.2s; }
        .nav-item:hover { color: #16a34a; }
        .nav-item.active { border-bottom-color: #16a34a; color: #16a34a; font-weight: 600; }
        
        /* Loader */
        .loader {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #16a34a;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Splitter Grid */
        .page-card.selected { border-color: #16a34a; background-color: #f0fdf4; box-shadow: 0 0 0 2px #16a34a; }
        .page-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <div class="flex items-center gap-2 cursor-pointer" onclick="switchTab('compress')">
                    <div class="bg-green-600 text-white p-1.5 rounded-lg">
                        <i class="fa-solid fa-leaf text-lg"></i>
                    </div>
                    <span class="font-bold text-xl text-gray-800 tracking-tight">PDFMint</span>
                </div>
                
                <div class="hidden md:flex space-x-6 text-sm font-medium">
                    <div onclick="switchTab('merge')" id="nav-merge" class="nav-item py-5 px-1">Merge PDF</div>
                    <div onclick="switchTab('split')" id="nav-split" class="nav-item py-5 px-1">Split PDF</div>
                    <div onclick="switchTab('compress')" id="nav-compress" class="nav-item active py-5 px-1">Compress PDF</div>
                    <div onclick="switchTab('img2pdf')" id="nav-img2pdf" class="nav-item py-5 px-1">JPG to PDF</div>
                </div>

                <div class="md:hidden flex items-center">
                    <button onclick="document.getElementById('mobile-menu').classList.toggle('hidden')" class="text-gray-500 hover:text-green-600 focus:outline-none">
                        <i class="fa-solid fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-100 p-4 space-y-2 shadow-lg absolute w-full">
            <button onclick="switchTab('merge')" class="block w-full text-left py-2 px-4 hover:bg-green-50 rounded font-medium text-gray-600">Merge PDF</button>
            <button onclick="switchTab('split')" class="block w-full text-left py-2 px-4 hover:bg-green-50 rounded font-medium text-gray-600">Split PDF</button>
            <button onclick="switchTab('compress')" class="block w-full text-left py-2 px-4 hover:bg-green-50 rounded font-medium text-gray-600">Compress PDF</button>
            <button onclick="switchTab('img2pdf')" class="block w-full text-left py-2 px-4 hover:bg-green-50 rounded font-medium text-gray-600">Image to PDF</button>
        </div>
    </nav>

    <main class="flex-grow w-full max-w-7xl mx-auto p-4 md:p-8">

        <section id="tool-compress" class="flex flex-col items-center">
            <div class="text-center mb-8 mt-4">
                <h1 class="text-3xl md:text-5xl font-bold text-gray-900 mb-4">Compress PDF</h1>
                <p class="text-gray-600 max-w-2xl mx-auto">Reduce file size while optimizing for maximal PDF quality.</p>
            </div>
            <div id="comp-upload-area" class="w-full max-w-xl text-center">
                <div class="drop-zone bg-white rounded-2xl border-2 border-dashed border-gray-300 p-10 hover:border-green-500 hover:bg-green-50 transition-all cursor-pointer relative group">
                    <input type="file" id="comp-file" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="application/pdf">
                    <i class="fa-solid fa-file-pdf text-4xl text-green-600 mb-4 group-hover:scale-110 transition"></i>
                    <h3 class="text-lg font-bold text-gray-700">Select PDF file</h3>
                    <p class="text-gray-400 text-sm mt-1">or drop PDF here</p>
                </div>
            </div>
            <div id="comp-settings" class="hidden w-full max-w-3xl bg-white rounded-xl shadow-lg mt-6 p-6 flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-1/2 flex flex-col justify-center items-center bg-gray-50 rounded-lg p-6">
                    <i class="fa-solid fa-file-pdf text-5xl text-red-500 mb-3"></i>
                    <p id="comp-name" class="font-bold text-gray-800 break-all text-center">filename.pdf</p>
                    <p id="comp-size" class="text-sm text-gray-500">2.5 MB</p>
                </div>
                <div class="w-full md:w-1/2 flex flex-col justify-between">
                    <div>
                        <h3 class="font-bold mb-3">Compression Mode</h3>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 border rounded cursor-pointer hover:bg-green-50 transition">
                                <input type="radio" name="comp-level" value="extreme" class="text-green-600">
                                <div class="ml-3"><span class="font-bold text-sm block">Extreme</span><span class="text-xs text-gray-500">Low quality, max compression</span></div>
                            </label>
                            <label class="flex items-center p-3 border bg-green-50 border-green-200 rounded cursor-pointer">
                                <input type="radio" name="comp-level" value="recommended" checked class="text-green-600">
                                <div class="ml-3"><span class="font-bold text-sm block">Recommended</span><span class="text-xs text-gray-500">Good quality, good compression</span></div>
                            </label>
                        </div>
                    </div>
                    <button id="btn-comp-start" class="mt-6 w-full bg-gray-900 text-white py-3 rounded-lg font-bold hover:bg-gray-800 flex justify-center items-center gap-2">Compress PDF</button>
                </div>
            </div>
        </section>

        <section id="tool-merge" class="hidden flex-col items-center">
            <div class="text-center mb-8 mt-4">
                <h1 class="text-3xl md:text-5xl font-bold text-gray-900 mb-4">Merge PDF Files</h1>
                <p class="text-gray-600 max-w-2xl mx-auto">Combine PDFs in the order you want with the easiest PDF merger.</p>
            </div>
            <div id="merge-upload-area" class="w-full max-w-xl text-center">
                <div class="drop-zone bg-white rounded-2xl border-2 border-dashed border-gray-300 p-10 hover:border-green-500 hover:bg-green-50 transition-all cursor-pointer relative group">
                    <input type="file" id="merge-file" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="application/pdf" multiple>
                    <i class="fa-solid fa-layer-group text-4xl text-green-600 mb-4 group-hover:scale-110 transition"></i>
                    <h3 class="text-lg font-bold text-gray-700">Select PDF files</h3>
                    <p class="text-gray-400 text-sm mt-1">or drop PDFs here</p>
                </div>
            </div>
            <div id="merge-workspace" class="hidden w-full max-w-3xl mt-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-gray-700">Files to Merge</h3>
                    <button onclick="document.getElementById('merge-file-add').click()" class="text-green-600 font-bold text-sm hover:underline">+ Add More</button>
                    <input type="file" id="merge-file-add" class="hidden" accept="application/pdf" multiple>
                </div>
                <div id="merge-list" class="space-y-2 mb-6">
                    </div>
                <button id="btn-merge-start" class="w-full bg-gray-900 text-white py-4 rounded-xl font-bold text-lg hover:bg-gray-800 shadow-lg">Merge PDFs Now</button>
            </div>
        </section>

        <section id="tool-split" class="hidden flex-col items-center">
            <div class="text-center mb-8 mt-4">
                <h1 class="text-3xl md:text-5xl font-bold text-gray-900 mb-4">Split PDF File</h1>
                <p class="text-gray-600 max-w-2xl mx-auto">Separate one page or a whole set for easy conversion into independent PDF files.</p>
            </div>
            <div id="split-upload-area" class="w-full max-w-xl text-center">
                <div class="drop-zone bg-white rounded-2xl border-2 border-dashed border-gray-300 p-10 hover:border-green-500 hover:bg-green-50 transition-all cursor-pointer relative group">
                    <input type="file" id="split-file" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="application/pdf">
                    <i class="fa-solid fa-scissors text-4xl text-green-600 mb-4 group-hover:scale-110 transition"></i>
                    <h3 class="text-lg font-bold text-gray-700">Select PDF to Split</h3>
                </div>
            </div>
            <div id="split-workspace" class="hidden w-full max-w-5xl mt-6 flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-3/4 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold text-gray-700">Select Pages</h3>
                        <button onclick="selectAllPages()" class="text-sm text-green-600 font-semibold">Select All</button>
                    </div>
                    <div id="split-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 gap-3 max-h-[500px] overflow-y-auto p-2">
                        </div>
                </div>
                <div class="w-full md:w-1/4">
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-100 sticky top-24">
                        <h3 class="font-bold text-gray-800 mb-4">Split Options</h3>
                        <div class="mb-4">
                            <label class="block text-xs font-bold text-gray-500 uppercase mb-2">Range Mode</label>
                            <input type="text" id="split-range-input" placeholder="e.g. 1-5, 8, 10" class="w-full border border-gray-300 rounded-lg p-2 text-sm focus:ring-green-500 focus:border-green-500">
                            <p class="text-xs text-gray-400 mt-1">Type ranges or select pages.</p>
                        </div>
                        <button id="btn-split-start" class="w-full bg-gray-900 text-white py-3 rounded-lg font-bold hover:bg-gray-800">Split PDF</button>
                        <button onclick="resetSplit()" class="w-full mt-2 text-gray-500 text-sm hover:underline">Reset</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="tool-img2pdf" class="hidden flex-col items-center">
            <div class="text-center mb-8 mt-4">
                <h1 class="text-3xl md:text-5xl font-bold text-gray-900 mb-4">JPG to PDF</h1>
                <p class="text-gray-600">Convert JPG/PNG images to PDF instantly.</p>
            </div>
            <div id="img-upload-area" class="w-full max-w-xl text-center">
                <div class="drop-zone bg-white rounded-2xl border-2 border-dashed border-gray-300 p-10 hover:border-green-500 hover:bg-green-50 transition-all cursor-pointer relative group">
                    <input type="file" id="img-file" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/*" multiple>
                    <i class="fa-regular fa-images text-4xl text-green-600 mb-4"></i>
                    <h3 class="text-lg font-bold text-gray-700">Select Images</h3>
                </div>
            </div>
            <div id="img-workspace" class="hidden w-full max-w-4xl mt-6 flex flex-col md:flex-row gap-6">
                <div class="w-full md:w-2/3 bg-white p-6 rounded-xl border border-gray-200">
                    <div id="img-list" class="grid grid-cols-3 gap-3"></div>
                </div>
                <div class="w-full md:w-1/3 p-6 bg-white rounded-xl shadow-lg h-fit">
                    <h3 class="font-bold mb-4">Settings</h3>
                    <div class="mb-4">
                         <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Orientation</label>
                         <select id="img-orientation" class="w-full border p-2 rounded"><option value="p">Portrait</option><option value="l">Landscape</option></select>
                    </div>
                    <button id="btn-img-start" class="w-full bg-gray-900 text-white py-3 rounded-lg font-bold hover:bg-gray-800">Convert</button>
                </div>
            </div>
        </section>

        <div id="result-area" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-8 max-w-md w-full text-center shadow-2xl animate-fade-in-up">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fa-solid fa-check text-2xl text-green-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Success!</h2>
                <p id="result-msg" class="text-gray-600 mb-6">Your file is ready.</p>
                <a id="download-btn" href="#" class="block w-full bg-gray-900 text-white py-3 rounded-xl font-bold hover:bg-gray-800 mb-3">
                    <i class="fa-solid fa-download mr-2"></i> Download File
                </a>
                <button onclick="document.getElementById('result-area').classList.add('hidden')" class="text-gray-500 text-sm hover:underline">Close</button>
            </div>
        </div>

    </main>

    <footer class="bg-white border-t border-gray-200 mt-auto">
        <div class="max-w-7xl mx-auto py-8 px-4 text-center text-gray-500 text-sm">
            <p>&copy; 2024 PDFMint. Secure Client-Side PDF Tools.</p>
        </div>
    </footer>

    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // --- Global Config ---
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        const { PDFDocument } = PDFLib;

        // --- Tab Switching ---
        function switchTab(tabId) {
            // Hide all sections
            ['tool-compress','tool-merge','tool-split','tool-img2pdf'].forEach(id => {
                document.getElementById(id).classList.remove('flex');
                document.getElementById(id).classList.add('hidden');
            });
            // Show selected
            document.getElementById(`tool-${tabId}`).classList.remove('hidden');
            document.getElementById(`tool-${tabId}`).classList.add('flex');
            
            // Update Nav
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const navBtn = document.getElementById(`nav-${tabId}`);
            if(navBtn) navBtn.classList.add('active');
            
            // Close mobile menu
            document.getElementById('mobile-menu').classList.add('hidden');
        }

        // --- Common Helpers ---
        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(decimals))} ${sizes[i]}`;
        }

        function showResult(blob, filename, msg = "Processing complete!") {
            const url = URL.createObjectURL(blob);
            const dlBtn = document.getElementById('download-btn');
            dlBtn.href = url;
            dlBtn.download = filename;
            document.getElementById('result-msg').textContent = msg;
            document.getElementById('result-area').classList.remove('hidden');
        }

        // --- Drag & Drop Setup ---
        function setupDnD(dropZoneId, inputId, callback) {
            const dz = document.getElementById(dropZoneId);
            const inp = document.getElementById(inputId);
            
            dz.addEventListener('dragover', e => { e.preventDefault(); dz.classList.add('drag-active'); });
            dz.addEventListener('dragleave', () => dz.classList.remove('drag-active'));
            dz.addEventListener('drop', e => {
                e.preventDefault();
                dz.classList.remove('drag-active');
                if(e.dataTransfer.files.length) callback(e.dataTransfer.files);
            });
            dz.addEventListener('click', () => inp.click());
            inp.addEventListener('change', e => { if(e.target.files.length) callback(e.target.files); });
        }

        /* =========================================
           LOGIC: COMPRESSOR
           ========================================= */
        let compFile = null;
        setupDnD('comp-upload-area', 'comp-file', (files) => {
            if(files[0].type !== 'application/pdf') return alert('PDF only');
            compFile = files[0];
            document.getElementById('comp-name').textContent = compFile.name;
            document.getElementById('comp-size').textContent = formatBytes(compFile.size);
            document.getElementById('comp-upload-area').classList.add('hidden');
            document.getElementById('comp-settings').classList.remove('hidden');
            document.getElementById('comp-settings').classList.add('flex');
        });

        document.getElementById('btn-comp-start').addEventListener('click', async () => {
            const btn = document.getElementById('btn-comp-start');
            btn.innerHTML = '<div class="loader mr-2"></div> Processing...';
            
            const mode = document.querySelector('input[name="comp-level"]:checked').value;
            const scale = mode === 'extreme' ? 1.0 : 1.5; 
            const quality = mode === 'extreme' ? 0.4 : 0.6;

            try {
                const ab = await compFile.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(ab).promise;
                const { jsPDF } = window.jspdf;
                const newPdf = new jsPDF({ compress: true });
                
                for(let i=1; i<=pdf.numPages; i++){
                    const page = await pdf.getPage(i);
                    const vp = page.getViewport({ scale: scale });
                    const cvs = document.createElement('canvas');
                    cvs.width = vp.width; cvs.height = vp.height;
                    await page.render({ canvasContext: cvs.getContext('2d'), viewport: vp }).promise;
                    const img = cvs.toDataURL('image/jpeg', quality);
                    if(i>1) newPdf.addPage([vp.width, vp.height]);
                    else { newPdf.deletePage(1); newPdf.addPage([vp.width, vp.height]); }
                    newPdf.addImage(img, 'JPEG', 0, 0, vp.width, vp.height);
                }
                showResult(newPdf.output('blob'), `compressed_${compFile.name}`, "Compression Successful!");
            } catch(e) { console.error(e); alert('Error compressing'); }
            btn.innerHTML = 'Compress PDF';
        });


        /* =========================================
           LOGIC: MERGER
           ========================================= */
        let mergeFiles = []; // {id, file}
        const mergeListEl = document.getElementById('merge-list');
        
        setupDnD('merge-upload-area', 'merge-file', handleMergeFiles);
        document.getElementById('merge-file-add').addEventListener('change', e => handleMergeFiles(e.target.files));

        function handleMergeFiles(files) {
            document.getElementById('merge-upload-area').classList.add('hidden');
            document.getElementById('merge-workspace').classList.remove('hidden');
            
            Array.from(files).forEach(f => {
                if(f.type !== 'application/pdf') return;
                const id = Math.random().toString(36).substr(2,9);
                mergeFiles.push({ id, file: f });
                
                const div = document.createElement('div');
                div.className = "flex items-center justify-between bg-white p-3 rounded border shadow-sm cursor-move";
                div.setAttribute('data-id', id);
                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <i class="fa-solid fa-file-pdf text-red-500"></i>
                        <span class="text-sm font-medium truncate max-w-[200px]">${f.name}</span>
                        <span class="text-xs text-gray-400">${formatBytes(f.size)}</span>
                    </div>
                    <button onclick="removeMergeFile('${id}')" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                `;
                mergeListEl.appendChild(div);
            });
        }
        
        window.removeMergeFile = (id) => {
            mergeFiles = mergeFiles.filter(x => x.id !== id);
            document.querySelector(`div[data-id="${id}"]`).remove();
            if(!mergeFiles.length) {
                document.getElementById('merge-workspace').classList.add('hidden');
                document.getElementById('merge-upload-area').classList.remove('hidden');
            }
        };

        new Sortable(mergeListEl, { animation: 150 });

        document.getElementById('btn-merge-start').addEventListener('click', async () => {
            const btn = document.getElementById('btn-merge-start');
            btn.innerHTML = '<div class="loader mr-2"></div> Merging...';
            
            try {
                // Get order from DOM
                const orderedIds = Array.from(mergeListEl.children).map(el => el.getAttribute('data-id'));
                const mergedPdf = await PDFDocument.create();
                
                for(const id of orderedIds) {
                    const fObj = mergeFiles.find(x => x.id === id);
                    if(!fObj) continue;
                    const ab = await fObj.file.arrayBuffer();
                    const pdf = await PDFDocument.load(ab);
                    const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
                    copiedPages.forEach(page => mergedPdf.addPage(page));
                }
                
                const pdfBytes = await mergedPdf.save();
                showResult(new Blob([pdfBytes], {type: 'application/pdf'}), 'merged_document.pdf', 'Files Merged Successfully!');
            } catch(e) { console.error(e); alert('Error merging'); }
            btn.innerHTML = 'Merge PDFs Now';
        });

        /* =========================================
           LOGIC: SPLITTER
           ========================================= */
        let splitFile = null;
        let splitPdfDoc = null; // PDFJS proxy
        let totalPages = 0;
        let selectedPages = new Set(); // Stores page indices (1-based)

        setupDnD('split-upload-area', 'split-file', async (files) => {
            if(files[0].type !== 'application/pdf') return alert('PDF only');
            splitFile = files[0];
            
            document.getElementById('split-upload-area').classList.add('hidden');
            document.getElementById('split-workspace').classList.remove('hidden');
            document.getElementById('split-workspace').classList.add('flex');
            
            // Render basic grid
            const ab = await splitFile.arrayBuffer();
            splitPdfDoc = await pdfjsLib.getDocument(ab).promise;
            totalPages = splitPdfDoc.numPages;
            
            const grid = document.getElementById('split-grid');
            grid.innerHTML = '';
            selectedPages.clear();
            
            for(let i=1; i<=totalPages; i++) {
                const el = document.createElement('div');
                el.className = "page-card border rounded p-2 flex flex-col items-center justify-center cursor-pointer bg-gray-50 h-24 relative transition-all";
                el.onclick = () => togglePage(i, el);
                el.innerHTML = `<span class="font-bold text-gray-500">Pg ${i}</span><i class="fa-regular fa-circle-check absolute top-2 right-2 text-gray-300 check-icon"></i>`;
                grid.appendChild(el);
            }
        });

        function togglePage(num, el) {
            if(selectedPages.has(num)) {
                selectedPages.delete(num);
                el.classList.remove('selected');
                el.querySelector('.check-icon').classList.remove('text-green-600', 'fa-solid');
                el.querySelector('.check-icon').classList.add('text-gray-300', 'fa-regular');
            } else {
                selectedPages.add(num);
                el.classList.add('selected');
                el.querySelector('.check-icon').classList.remove('text-gray-300', 'fa-regular');
                el.querySelector('.check-icon').classList.add('text-green-600', 'fa-solid');
            }
            updateRangeInput();
        }

        window.selectAllPages = () => {
            const cards = document.querySelectorAll('.page-card');
            cards.forEach((el, idx) => {
                if(!selectedPages.has(idx+1)) togglePage(idx+1, el);
            });
        }

        function updateRangeInput() {
            const arr = Array.from(selectedPages).sort((a,b)=>a-b);
            document.getElementById('split-range-input').value = arr.join(',');
        }

        // Allow manual typing in range input
        document.getElementById('split-range-input').addEventListener('input', (e) => {
             // Logic to parse range "1-3, 5" back to UI is complex for this snippet, 
             // so we prioritize the Input value during processing over visual selection if user types manually.
        });

        document.getElementById('btn-split-start').addEventListener('click', async () => {
            const btn = document.getElementById('btn-split-start');
            btn.innerHTML = '<div class="loader mr-2"></div> Splitting...';
            
            try {
                // Parse Range Input first
                const rangeStr = document.getElementById('split-range-input').value;
                let pagesToKeep = new Set();
                
                if(rangeStr.trim()) {
                    // Parse "1-5, 8"
                    const parts = rangeStr.split(',');
                    parts.forEach(p => {
                        if(p.includes('-')) {
                            const [start, end] = p.split('-').map(Number);
                            for(let k=start; k<=end; k++) if(k<=totalPages) pagesToKeep.add(k);
                        } else {
                            const n = Number(p);
                            if(n && n<=totalPages) pagesToKeep.add(n);
                        }
                    });
                } else {
                    // Use visual selection
                    pagesToKeep = selectedPages;
                }

                if(pagesToKeep.size === 0) throw new Error("No pages selected");

                // Create new PDF
                const ab = await splitFile.arrayBuffer();
                const srcDoc = await PDFDocument.load(ab);
                const newDoc = await PDFDocument.create();
                
                // copyPages takes 0-based indices
                const indices = Array.from(pagesToKeep).map(n => n-1).sort((a,b)=>a-b);
                const copied = await newDoc.copyPages(srcDoc, indices);
                copied.forEach(p => newDoc.addPage(p));
                
                const pdfBytes = await newDoc.save();
                showResult(new Blob([pdfBytes], {type: 'application/pdf'}), `split_${splitFile.name}`, "Split Successful!");

            } catch(e) { alert(e.message); }
            btn.innerHTML = 'Split PDF';
        });
        
        window.resetSplit = () => {
            splitFile = null;
            document.getElementById('split-workspace').classList.add('hidden');
            document.getElementById('split-upload-area').classList.remove('hidden');
        };

        /* =========================================
           LOGIC: IMG 2 PDF
           ========================================= */
        // Simplified for brevity - reuse basic logic from previous version
        let imgFiles = [];
        setupDnD('img-upload-area', 'img-file', (files) => {
             document.getElementById('img-upload-area').classList.add('hidden');
             document.getElementById('img-workspace').classList.remove('hidden');
             document.getElementById('img-workspace').classList.add('flex');
             const list = document.getElementById('img-list');
             
             Array.from(files).forEach(f => {
                 if(!f.type.startsWith('image/')) return;
                 const url = URL.createObjectURL(f);
                 imgFiles.push({ file: f, url });
                 const div = document.createElement('div');
                 div.className = "aspect-square bg-gray-50 rounded border flex items-center justify-center overflow-hidden relative";
                 div.innerHTML = `<img src="${url}" class="object-cover w-full h-full">`;
                 list.appendChild(div);
             });
        });

        document.getElementById('btn-img-start').addEventListener('click', async () => {
            const { jsPDF } = window.jspdf;
            const orient = document.getElementById('img-orientation').value;
            const doc = new jsPDF({ orientation: orient === 'l' ? 'landscape' : 'portrait' });
            
            doc.deletePage(1); // start fresh
            
            for(const img of imgFiles) {
                // Get dims
                const imgProps = await new Promise(r => {
                    const i = new Image();
                    i.onload = () => r(i);
                    i.src = img.url;
                });
                
                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const ratio = Math.min(pageWidth / imgProps.width, pageHeight / imgProps.height);
                const w = imgProps.width * ratio;
                const h = imgProps.height * ratio;
                
                doc.addPage();
                doc.addImage(img.url, 'JPEG', (pageWidth-w)/2, (pageHeight-h)/2, w, h);
            }
            showResult(doc.output('blob'), 'images_converted.pdf', 'Conversion Complete!');
        });

    </script>
</body>
</html>
