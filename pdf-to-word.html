<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF to Word Converter | MintPDF</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .text-mint-600 { color: #059669; }
        .bg-mint-600 { background-color: #059669; }
        .bg-mint-50 { background-color: #ecfdf5; }
        /* Progress Bar Animation */
        .progress-stripe { background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent); background-size: 1rem 1rem; animation: progress-bar-stripes 1s linear infinite; }
        @keyframes progress-bar-stripes { from { background-position: 1rem 0; } to { background-position: 0 0; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 min-h-screen flex flex-col items-center p-4">

    <nav class="w-full max-w-4xl flex justify-between items-center py-6 mb-8">
        <a href="/" class="flex items-center gap-2 font-extrabold text-2xl">
            Mint<span class="text-mint-600">PDF</span>
        </a>
        <a href="/" class="text-slate-500 hover:text-slate-800 text-sm font-medium"><i class="fa-solid fa-arrow-left"></i> Back to Home</a>
    </nav>

    <main class="w-full max-w-xl bg-white rounded-3xl shadow-xl border border-slate-100 overflow-hidden">
        
        <div class="p-8 text-center border-b border-slate-100">
            <h1 class="text-3xl font-bold text-slate-900 mb-2">PDF to Word</h1>
            <p class="text-slate-500">Convert files securely using our Cloud Server.</p>
        </div>

        <div id="step-upload" class="p-8">
            <label class="flex flex-col items-center justify-center w-full h-64 border-2 border-slate-300 border-dashed rounded-2xl cursor-pointer bg-slate-50 hover:bg-mint-50 hover:border-mint-500 transition-all group">
                <div class="flex flex-col items-center justify-center pt-5 pb-6">
                    <div class="w-16 h-16 bg-white rounded-full shadow-md flex items-center justify-center mb-4 group-hover:scale-110 transition">
                        <i class="fa-solid fa-cloud-arrow-up text-3xl text-mint-600"></i>
                    </div>
                    <p class="mb-2 text-lg font-bold text-slate-700">Click to upload PDF</p>
                    <p class="text-sm text-slate-400">Up to 50MB supported</p>
                </div>
                <input id="file-input" type="file" class="hidden" accept="application/pdf" />
            </label>
        </div>

        <div id="step-process" class="hidden p-8">
            
            <div class="flex items-center gap-4 mb-6 bg-slate-50 p-4 rounded-xl">
                <div class="w-10 h-10 bg-red-100 text-red-500 rounded-lg flex items-center justify-center">
                    <i class="fa-solid fa-file-pdf"></i>
                </div>
                <div class="overflow-hidden">
                    <h3 id="filename" class="font-bold text-slate-800 truncate">document.pdf</h3>
                    <p id="filesize" class="text-xs text-slate-500">0 MB</p>
                </div>
            </div>

            <div class="space-y-4">
                
                <div class="relative">
                    <div class="flex justify-between text-sm font-bold mb-1">
                        <span id="label-upload" class="text-slate-400">1. Uploading...</span>
                        <span id="percent-upload" class="text-mint-600">0%</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-2.5">
                        <div id="bar-upload" class="bg-mint-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>

                <div class="relative opacity-50" id="group-convert">
                    <div class="flex justify-between text-sm font-bold mb-1">
                        <span id="label-convert" class="text-slate-400">2. Waking Server & Converting...</span>
                        <span id="icon-convert" class="text-slate-400"><i class="fa-solid fa-clock"></i></span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-2.5 overflow-hidden">
                        <div id="bar-convert" class="bg-blue-500 h-2.5 rounded-full transition-all duration-[10s] w-0"></div>
                    </div>
                    <p class="text-xs text-slate-400 mt-1 italic">Note: The first run may take ~50 seconds to wake up the server.</p>
                </div>

                <div class="relative opacity-50" id="group-download">
                    <div class="flex justify-between text-sm font-bold mb-1">
                        <span id="label-download" class="text-slate-400">3. Downloading</span>
                    </div>
                </div>

            </div>
            
            <div id="error-box" class="hidden mt-4 p-3 bg-red-50 text-red-600 text-sm font-bold rounded-lg text-center">
                Error: Server timed out or file too big.
            </div>

            <button onclick="location.reload()" id="btn-reset" class="hidden w-full mt-6 bg-slate-800 text-white py-3 rounded-xl font-bold hover:bg-slate-900">Convert Another File</button>
        </div>

    </main>

    <script>
        // ========================================================
        // YOUR RENDER SERVER URL
        // ========================================================
        const TUNNEL_URL = "https://pdftools-nhgx.onrender.com/convert"; 
        // ========================================================

        const fileInput = document.getElementById('file-input');
        const stepUpload = document.getElementById('step-upload');
        const stepProcess = document.getElementById('step-process');
        
        fileInput.addEventListener('change', startProcess);

        function startProcess(e) {
            const file = e.target.files[0];
            if (!file) return;

            // Setup UI
            stepUpload.classList.add('hidden');
            stepProcess.classList.remove('hidden');
            document.getElementById('filename').innerText = file.name;
            document.getElementById('filesize').innerText = (file.size / (1024*1024)).toFixed(2) + " MB";

            uploadFile(file);
        }

        function uploadFile(file) {
            const xhr = new XMLHttpRequest();
            const formData = new FormData();
            formData.append("file", file);

            // 1. TRACK UPLOAD PROGRESS
            xhr.upload.addEventListener("progress", (e) => {
                if (e.lengthComputable) {
                    const percent = Math.round((e.loaded / e.total) * 100);
                    document.getElementById('bar-upload').style.width = percent + "%";
                    document.getElementById('percent-upload').innerText = percent + "%";
                }
            });

            // 2. UPLOAD COMPLETE -> START CONVERSION UI
            xhr.upload.addEventListener("load", () => {
                document.getElementById('label-upload').innerText = "✅ Upload Complete";
                document.getElementById('label-upload').className = "text-green-600 font-bold";
                
                // Activate Conversion Step
                document.getElementById('group-convert').classList.remove('opacity-50');
                document.getElementById('label-convert').className = "text-blue-600 font-bold animate-pulse";
                document.getElementById('bar-convert').className = "bg-blue-500 h-2.5 rounded-full progress-stripe w-full"; // Start striped animation
                document.getElementById('icon-convert').innerHTML = '<i class="fa-solid fa-gear fa-spin"></i>';
            });

            // 3. HANDLE SERVER RESPONSE
            xhr.open("POST", TUNNEL_URL, true);
            xhr.responseType = "blob"; // Expect a file back

            xhr.onload = function() {
                if (xhr.status === 200) {
                    // Success!
                    document.getElementById('label-convert').innerText = "✅ Conversion Complete";
                    document.getElementById('label-convert').className = "text-green-600 font-bold";
                    document.getElementById('bar-convert').className = "bg-green-500 h-2.5 rounded-full w-full";
                    document.getElementById('icon-convert').innerHTML = '<i class="fa-solid fa-check"></i>';

                    // Activate Download Step
                    document.getElementById('group-download').classList.remove('opacity-50');
                    document.getElementById('label-download').innerText = "✅ Download Started";
                    document.getElementById('label-download').className = "text-green-600 font-bold";

                    // Trigger Download
                    const blob = xhr.response;
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = file.name.replace(".pdf", ".docx");
                    document.body.appendChild(a);
                    a.click();
                    
                    document.getElementById('btn-reset').classList.remove('hidden');

                } else {
                    showError();
                }
            };

            xhr.onerror = function() { showError(); };
            
            // Send the file
            xhr.send(formData);
        }

        function showError() {
            document.getElementById('error-box').classList.remove('hidden');
            document.getElementById('label-convert').innerText = "❌ Conversion Failed";
            document.getElementById('label-convert').className = "text-red-600 font-bold";
            document.getElementById('bar-convert').className = "bg-red-500 h-2.5 rounded-full w-full";
            document.getElementById('btn-reset').classList.remove('hidden');
        }
    </script>
</body>
</html>
